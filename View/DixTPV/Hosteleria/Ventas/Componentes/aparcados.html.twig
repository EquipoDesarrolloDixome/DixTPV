<div class="container-fluid">
    <div class="list-group aparcados-list" id="aparcadosContainer">
        {% set listaAparcados = aparcadosLista|default(fsc.aparcados) %}
        {% set tieneAparcados = false %}
        {% for aparcado in listaAparcados %}
            {% if fsc.modoHosteleria or not aparcado.idmesa %}
                {% set tieneAparcados = true %}
                {% set esListadoGeneral = aparcado.nombremesa is empty or aparcado.nombremesa == 'Listado' %}
                <div class="list-group-item aparcados-line d-flex flex-column flex-xl-row gap-2 gap-xl-3 align-items-xl-center" data-aparcado="{{ aparcado.idcomanda }}">
                    <div class="d-flex align-items-center flex-wrap gap-2 aparcados-line-main">
                        <span class="badge bg-primary text-white aparcados-line-id">#{{ aparcado.idcomanda }}</span>
                        <span class="fw-semibold text-truncate aparcados-line-client">
                            {{ aparcado.nombrecliente ? aparcado.nombrecliente : 'Sin cliente' }}
                        </span>
                        <span class="small text-muted aparcados-line-date">
                            {{ aparcado.fecha ? aparcado.fecha|date('d/m/Y H:i') : '-' }}
                        </span>
                    </div>
                    <div class="d-flex flex-wrap gap-3 flex-grow-1 small text-muted aparcados-line-info">
                        <span>
                            <span class="text-uppercase aparcados-line-label">Ubicación:</span>
                            {% if aparcado.nombresalon %}
                                {{ aparcado.nombresalon }}
                            {% else %}
                                Aparcados
                            {% endif %}
                            {% if aparcado.nombremesa %}
                                · Mesa {{ aparcado.nombremesa }}
                            {% elseif not fsc.modoHosteleria %}
                                · Listado
                            {% else %}
                                · Sin mesa
                            {% endif %}
                        </span>
                        <span>
                            <span class="text-uppercase aparcados-line-label">Estado:</span>
                            {{ aparcado.idestado ?: 'Sin estado' }}
                        </span>
                    </div>
                    <div class="aparcados-line-amount text-nowrap text-success fw-bold">
                        {{ (aparcado.total ?? 0)|number_format(2, ',', '.') }} €
                    </div>
                    <div class="d-flex flex-shrink-0 gap-1 aparcados-line-actions">
                        <button class="btn btn-sm btn-primary" onclick="cargarAparcado('{{ aparcado.idcomanda }}')">
                            <i class="fa-solid fa-folder-open"></i>
                        </button>
                        {% if fsc.modoHosteleria and esListadoGeneral %}
                        <button class="btn btn-sm btn-warning" onclick="dixMoverAparcadoListadoAMesa('{{ aparcado.idcomanda }}')">
                            <i class="fa-solid fa-chair"></i>
                        </button>
                        {% endif %}
                        <button class="btn btn-sm btn-outline-success" onclick="imprimirAparcado('{{ aparcado.idcomanda }}')">
                            <i class="fa-solid fa-print"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="eliminarAparcado('{{ aparcado.idcomanda }}', this)">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        {% if not tieneAparcados %}
            <div class="list-group-item text-center text-muted">
                No hay tickets aparcados disponibles.
            </div>
        {% endif %}
    </div>
</div>
