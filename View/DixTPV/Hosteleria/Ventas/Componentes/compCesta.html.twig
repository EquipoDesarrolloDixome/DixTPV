{% set total = 0 %}
{% for producto in cesta %}
    {% set impuesto = producto.codimpuesto ?? 0 %}
    {% set pvpConImpuesto = producto.pvp * (1 + impuesto / 100) %}
    <div class="producto-item">
        <p class="nombreProdCompCesta">{{ producto.nombre }}</p>

        {# CANTIDAD #}
        <input type="number" value="{{ producto.cantidad }}"
               min="0" step="1" class="inputCantidadCompCesta"
               onchange="actualizarCantidadPorRef('{{ producto.referencia }}', this.value);">

        {# PRECIO con el mismo input que en el modal #}
        <input type="number" value="{{ pvpConImpuesto | number_format(2, '.', '') }}"
               min="0" step="0.01" class="inputPrecioCompCesta"
               onchange="actualizarPrecioPorRef('{{ producto.referencia }}', this.value, {{ impuesto|default(0) }});">

        <button class="btn btn-danger botonEliminarProductoCompCesta"
                onclick="eliminarProductoPorRef('{{ producto.referencia }}');">
            <i class="fas fa-trash"></i>
        </button>
    </div>
    {% set total = total + (pvpConImpuesto * producto.cantidad) %}
{% endfor %}

<div class="totalCompCesta">
    Total = {{ total | number_format(2, '.', '') }} â‚¬
</div>
